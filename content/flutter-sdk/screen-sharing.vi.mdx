---
title: Chia sẻ màn hình (iOS)
---

## Áp dụng trong code

Chia sẻ màn hình iOS cho phép bạn phát trực tiếp màn hình của mình dưới dạng một video track. Tài liệu này hướng dẫn cách thiết lập chia sẻ màn hình trên iOS.

### Các chế độ phát sóng

iOS hỗ trợ hai chế độ phát sóng:

- **Ghi màn hình trong ứng dụng (In-App screen recording):** Chỉ phát nội dung của ứng dụng của bạn.
- **Ghi màn hình bằng Broadcast Extension:** Phát nội dung màn hình trên bất kỳ ứng dụng nào.

Chia sẻ màn hình bắt đầu bằng cách gọi: `navigator.mediaDevices.getDisplayMedia(Map<String, dynamic> constraints)`. Mặc định, chế độ ghi màn hình trong ứng dụng (in-app screen recording) được sử dụng. Không cần thiết lập thêm gì cho chế độ này.

Chế độ ghi màn hình bằng Broadcast Extension có thể truy cập bằng cách đặt khóa `'deviceId'` thành `'broadcast'` trong `constraints`. Chia sẻ màn hình qua broadcast extension yêu cầu thêm bước thiết lập trong dự án iOS của bạn.

---

## Thiết lập nhanh Broadcast Extension

- Thêm một Broadcast Upload Extension mới, không có giao diện người dùng (UI), vào dự án trong Xcode. Cập nhật thông tin triển khai (deployment info) cho ứng dụng và broadcast extension để chạy trên iOS 14 trở lên.
- Thêm ứng dụng và broadcast extension vào cùng một nhóm ứng dụng (app group).
- Thêm giá trị app group id vào file `Info.plist` của ứng dụng với khóa `RTCAppGroupIdentifier`.
- Sao chép các file `SampleHandler.swift`, `SampleUploader.swift`, `SocketConnection.swift`, `DarwinNotificationCenter.swift` và `Atomic.swift` từ [dự án mẫu này](https://github.com/livekit/client-sdk-flutter/tree/main/example/ios/LiveKit%20Broadcast%20Extension) vào extension của bạn. Đảm bảo các file này được thêm vào target của extension.
- Cập nhật `appGroupIdentifier` trong `SampleHandler` để trả về app group identifier của bạn.

---

## Thêm Broadcast Extension

- Thêm Broadcast Upload Extension bằng cách chọn **File -> New -> Target**.


Điền đầy đủ thông tin cần thiết cho extension của bạn rồi nhấn Finish.

![ScreenSharing](https://media.waterbus.tech/waterbus-screen-sharing.png)

Đảm bảo thông tin triển khai (deployment info) của ứng dụng và broadcast extension đều được đặt là iOS 14 trở lên.

Thiết lập App Groups

Thêm extension của bạn vào một app group bằng cách vào target của extension trong dự án; trong tab Signings & Capabilities, nhấn nút + ở góc trên bên trái và thêm App Groups. Nếu bạn chưa làm điều này cho ứng dụng chính, hãy thêm App Groups vào ứng dụng chính và đảm bảo rằng định danh App Group (App Group identifier) giống nhau cho cả hai.

Thiết lập SampleHandler

Copy `SampleHandler.swift`, `SampleUploader.swift`, `SocketConnection.swift`, `DarwinNotificationCenter.swift` and `Atomic.swift` files from [this sample project](https://github.com/livekit/client-sdk-flutter/tree/main/example/ios/LiveKit%20Broadcast%20Extension) to your extension. You may already have a `SampleHandler.swift` auto-generated by XCode; just overwrite those contents.  
Update `appGroupIdentifier` in `SampleHandler` to return the app group identifier for your extension.

Your broadcast extension is now ready for broadcast through `getDisplayMedia`.

## Nguồn tham khảo
- https://github.com/flutter-webrtc/flutter-webrtc/wiki/iOS-Screen-Sharing
